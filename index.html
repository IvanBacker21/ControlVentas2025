<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tribu 2026 - Dashboard Integral</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.1.12/umd/Recharts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script> <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        body { background-color: #f8fafc; font-family: 'Inter', sans-serif; color: #334155; }
        
        /* Spinner Global */
        .spinner { width: 40px; height: 40px; border: 3px solid #e2e8f0; border-top-color: #e11d48; border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Estilos Generales Card */
        .card-pro { 
            background-color: white; 
            border: 1px solid #e2e8f0; 
            border-radius: 12px; 
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.05); 
            transition: all 0.3s ease;
        }
        .card-pro:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1); 
            border-color: #cbd5e1;
        }

        /* Scrollbars */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Estilos Espec√≠ficos Tab Estrategia */
        .txt-shadow { filter: drop-shadow(0 1px 2px rgba(0,0,0,0.1)); }

        /* Estilos Espec√≠ficos Tab Ventas */
        .clickable-chart .recharts-rectangle { cursor: pointer; }
        .gauge-container { position: relative; width: 100%; height: 100px; display: flex; justify-content: center; overflow: hidden; margin-bottom: 5px; }
        .gauge-value { position: absolute; bottom: 0px; width: 100%; text-align: center; line-height: 1; z-index: 10; }
        
        /* Estilos Espec√≠ficos Tab CXC (Badges y Riesgo) */
        .status-badge { padding: 4px 8px; border-radius: 6px; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; }
        .st-cobrado { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
        .st-pendiente { background: #fee2e2; color: #991b1b; border: 1px solid #fecaca; }
        
        .risk-corriente { background: #dcfce7; color: #15803d; border: 1px solid #bbf7d0; } 
        .risk-bajo { background: #ecfccb; color: #4d7c0f; border: 1px solid #d9f99d; } 
        .risk-medio { background: #fef9c3; color: #a16207; border: 1px solid #fde047; } 
        .risk-alto { background: #ffedd5; color: #c2410c; border: 1px solid #fed7aa; } 
        .risk-incobrable { background: #fee2e2; color: #b91c1c; border: 1px solid #fecaca; } 
        .risk-sinfecha { background: #f1f5f9; color: #64748b; border: 1px solid #cbd5e1; }

        th.sortable { cursor: pointer; user-select: none; transition: background 0.2s; }
        th.sortable:hover { background-color: #f1f5f9; color: #334155; }

        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useMemo } = React;
    const { BarChart, Bar, CartesianGrid, XAxis, YAxis, Tooltip, ResponsiveContainer, Cell, PieChart, Pie, LabelList, Legend } = Recharts;

    // =========================================================
    // DATA STATIC (Tab Estrategia)
    // =========================================================
    const DATA_STRATEGY_BARS = [
        { name: "Unilever", val: 27, color: "#16a34a" },
        { name: "P. Morris", val: 19, color: "#16a34a", opacity: 0.9 },
        { name: "DiDi", val: 14, color: "#2563eb" },
        { name: "Nissan", val: 13, color: "#2563eb" },
        { name: "Coppel", val: 12, color: "#2563eb" },
        { name: "Nestl√©", val: 11, color: "#2563eb" },
        { name: "BBVA", val: 9, color: "#2563eb", opacity: 0.9 },
        { name: "Santander", val: 9, color: "#2563eb", opacity: 0.9 },
        { name: "Amazon", val: 8, color: "#2563eb", opacity: 0.8 },
        { name: "Coca-Cola", val: 8, color: "#2563eb", opacity: 0.8 },
        { name: "Honda", val: 7, color: "#2563eb", opacity: 0.8 },
        { name: "Toyota", val: 7, color: "#2563eb", opacity: 0.8 },
        { name: "Heineken", val: 6, color: "#d97706" },
        { name: "Uber Eats", val: 6, color: "#d97706" },
        { name: "Liverpool", val: 5, color: "#d97706" },
        { name: "Palacio", val: 5, color: "#d97706" },
        { name: "Mercado Libre", val: 4, color: "#d97706" },
        { name: "Telcel", val: 4, color: "#d97706" },
        { name: "SEMAR", val: 3, color: "#dc2626" },
        { name: "Gob. CDMX", val: 3, color: "#dc2626" },
        { name: "Disney", val: 2, color: "#dc2626", opacity: 0.8 },
        { name: "Sony Music", val: 2, color: "#dc2626", opacity: 0.8 },
    ];

    const DATA_MATRIX = [
        { id: 1, client: "Unilever", ind: "Consumo Masivo", trend: "Creciente ‚Üë", trendClass: "text-green-600 font-bold", prob: "98%", badgeClass: "bg-green-100 text-green-700" },
        { id: 2, client: "Philip Morris", ind: "Consumo Masivo", trend: "Estable ‚Üí", trendClass: "text-blue-600 font-bold", prob: "95%", badgeClass: "bg-green-100 text-green-700" },
        { id: 3, client: "Nissan", ind: "Automotriz", trend: "Estable ‚Üí", trendClass: "text-blue-600 font-bold", prob: "92%", badgeClass: "bg-green-100 text-green-700" },
        { id: 4, client: "Coppel", ind: "Retail", trend: "Creciente ‚Üë", trendClass: "text-green-600 font-bold", prob: "90%", badgeClass: "bg-green-100 text-green-700" },
        { id: 5, client: "Nestl√©", ind: "Consumo Masivo", trend: "Estable ‚Üí", trendClass: "text-blue-600 font-bold", prob: "88%", badgeClass: "bg-green-100 text-green-700" },
        { id: 6, client: "DiDi", ind: "Tecnolog√≠a", trend: "Variable ‚Üù", trendClass: "text-amber-600 font-bold", prob: "85%", badgeClass: "bg-blue-100 text-blue-700" },
        { id: 7, client: "Amazon", ind: "E-Commerce", trend: "Recurrente ‚Üª", trendClass: "text-blue-600 font-bold", prob: "82%", badgeClass: "bg-blue-100 text-blue-700" },
        { id: 8, client: "Coca-Cola", ind: "Bebidas", trend: "Recurrente ‚Üª", trendClass: "text-blue-600 font-bold", prob: "80%", badgeClass: "bg-blue-100 text-blue-700" },
        { id: 9, client: "BBVA", ind: "Banca", trend: "Recurrente ‚Üª", trendClass: "text-blue-600 font-bold", prob: "78%", badgeClass: "bg-blue-100 text-blue-700" },
        { id: 10, client: "Santander", ind: "Banca", trend: "Recurrente ‚Üª", trendClass: "text-blue-600 font-bold", prob: "78%", badgeClass: "bg-blue-100 text-blue-700" },
        { id: 11, client: "Honda", ind: "Automotriz", trend: "Recurrente ‚Üª", trendClass: "text-blue-600 font-bold", prob: "75%", badgeClass: "bg-blue-100 text-blue-700" },
        { id: 12, client: "Heineken", ind: "Bebidas", trend: "Variable ‚Üù", trendClass: "text-amber-600 font-bold", prob: "70%", badgeClass: "bg-amber-100 text-amber-800" },
        { id: 13, client: "Uber Eats", ind: "Tecnolog√≠a", trend: "Variable ‚Üù", trendClass: "text-amber-600 font-bold", prob: "68%", badgeClass: "bg-amber-100 text-amber-800" },
        { id: 14, client: "Liverpool", ind: "Retail", trend: "Recurrente ‚Üª", trendClass: "text-blue-600 font-bold", prob: "65%", badgeClass: "bg-amber-100 text-amber-800" },
        { id: 15, client: "Mercado Libre", ind: "E-Commerce", trend: "Variable ‚Üù", trendClass: "text-amber-600 font-bold", prob: "60%", badgeClass: "bg-amber-100 text-amber-800" },
        { id: 16, client: "Telcel", ind: "Telecom", trend: "Variable ‚Üù", trendClass: "text-amber-600 font-bold", prob: "58%", badgeClass: "bg-amber-100 text-amber-800" },
        { id: 17, client: "Bimbo", ind: "Alimentos", trend: "Variable ‚Üù", trendClass: "text-amber-600 font-bold", prob: "55%", badgeClass: "bg-amber-100 text-amber-800" },
        { id: 18, client: "SEMAR", ind: "Gobierno", trend: "Espor√°dico ‚ö°", trendClass: "text-red-600 font-bold", prob: "45%", badgeClass: "bg-red-100 text-red-700" },
        { id: 19, client: "Gobierno CDMX", ind: "Gobierno", trend: "Espor√°dico ‚ö°", trendClass: "text-red-600 font-bold", prob: "40%", badgeClass: "bg-red-100 text-red-700" },
        { id: 20, client: "Disney", ind: "Entretenimiento", trend: "Inactivo üîª", trendClass: "text-red-600 font-bold", prob: "35%", badgeClass: "bg-red-100 text-red-700" },
        { id: 21, client: "Sony Music", ind: "Entretenimiento", trend: "Inactivo üîª", trendClass: "text-red-600 font-bold", prob: "30%", badgeClass: "bg-red-100 text-red-700" },
        { id: 22, client: "Volaris", ind: "Aerol√≠nea", trend: "Inactivo üîª", trendClass: "text-red-600 font-bold", prob: "30%", badgeClass: "bg-red-100 text-red-700" },
        { id: 23, client: "Tik Tok", ind: "Tecnolog√≠a", trend: "Espor√°dico ‚ö°", trendClass: "text-red-600 font-bold", prob: "25%", badgeClass: "bg-red-100 text-red-700" },
        { id: 24, client: "Bachoco", ind: "Alimentos", trend: "Inactivo üîª", trendClass: "text-red-600 font-bold", prob: "20%", badgeClass: "bg-red-100 text-red-700" },
        { id: 25, client: "Otros (Long Tail)", ind: "Varios", trend: "Espor√°dico ‚ö°", trendClass: "text-red-600 font-bold", prob: "<10%", badgeClass: "bg-red-100 text-red-700" },
    ];

    // =========================================================
    // PESTA√ëA ESTRATEGIA
    // =========================================================
    const TabStrategy = () => {
        return (
            <div className="fade-in max-w-[1200px] mx-auto pt-6 px-4">
                {/* Header */}
                <header className="bg-white border-b border-slate-200 py-8 mb-8 rounded-lg shadow-sm px-6">
                    <div className="flex justify-between items-center">
                        <div>
                            <h1 className="text-3xl font-extrabold text-slate-900 tracking-tight">Informe <strong>Recompra 2026</strong></h1>
                            <div className="text-slate-500 text-sm mt-1">Estrategia de Fidelizaci√≥n y Proyecci√≥n de Ventas</div>
                        </div>
                        <div className="text-right">
                            <div className="bg-slate-100 text-slate-500 px-3 py-1.5 rounded-md text-xs font-bold inline-block">√öltima Actualizaci√≥n</div>
                            <div className="text-xs opacity-80 mt-1 text-slate-500">Cierre 2025</div>
                        </div>
                    </div>
                </header>

                {/* KPI Cards */}
                <div className="grid grid-cols-1 md:grid-cols-3 gap-5 mb-8">
                    <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm text-center">
                        <span className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Cliente Top #1</span>
                        <span className="block text-4xl font-extrabold text-slate-900 leading-none">Unilever</span>
                        <span className="inline-block mt-2 text-xs font-bold bg-green-100 text-green-700 px-2 py-1 rounded-full">‚ñ≤ Outlier Positivo</span>
                    </div>
                    <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm text-center">
                        <span className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Total Transacciones</span>
                        <span className="block text-4xl font-extrabold text-slate-900 leading-none">145+</span>
                        <span className="block mt-2 text-xs font-medium text-slate-500">Periodo 2018-2025</span>
                    </div>
                    <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm text-center">
                        <span className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Concentraci√≥n (Pareto)</span>
                        <span className="block text-4xl font-extrabold text-slate-900 leading-none">15%</span>
                        <span className="block mt-2 text-xs font-medium text-slate-500">Genera el 80% del valor</span>
                    </div>
                </div>

                {/* Secci√≥n Gr√°ficas */}
                <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm mb-8">
                    <h2 className="text-xl font-bold text-slate-900 mb-6 border-b border-slate-200 pb-4">Resumen Visual de Cartera</h2>
                    
                    <div className="grid grid-cols-1 lg:grid-cols-[1.6fr_1fr] gap-10 items-start">
                        {/* Barras con Scroll */}
                        <div>
                            <h3 className="text-sm font-bold text-slate-500 uppercase tracking-wider text-center mb-5">Frecuencia de Compra (Ranking Completo)</h3>
                            <div className="custom-scroll overflow-y-auto max-h-[350px] pr-3">
                                <div className="w-full">
                                    {DATA_STRATEGY_BARS.map((item, idx) => (
                                        <div key={idx} className="flex items-center mb-3">
                                            <div className="w-[110px] text-xs font-bold text-right pr-4 text-slate-700 whitespace-nowrap overflow-hidden text-ellipsis flex-shrink-0">
                                                {item.name}
                                            </div>
                                            <div className="flex-grow bg-slate-100 rounded-md h-[18px] overflow-hidden">
                                                <div 
                                                    className="h-full rounded-md" 
                                                    style={{ 
                                                        width: `${(item.val / 30) * 100}%`, 
                                                        backgroundColor: item.color,
                                                        opacity: item.opacity || 1
                                                    }}
                                                >
                                                    <span className="float-right text-white text-[11px] font-bold leading-[18px] pr-2">{item.val}</span>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* Dona SVG */}
                        <div className="flex flex-col items-center sticky top-5">
                            <h3 className="text-sm font-bold text-slate-500 uppercase tracking-wider text-center mb-5">Nivel de Fidelizaci√≥n</h3>
                            
                            <svg className="overflow-visible max-w-full h-auto" width="280" height="280" viewBox="0 0 40 40">
                                <circle cx="20" cy="20" r="15.9155" fill="none" stroke="#f1f5f9" strokeWidth="8"></circle>
                                
                                <circle cx="20" cy="20" r="15.9155" fill="none" stroke="#16a34a" strokeWidth="8" strokeDasharray="15 85" strokeDashoffset="25"></circle>
                                <text x="27.2" y="5.8" className="text-[3px] font-bold fill-white txt-shadow font-sans text-center" textAnchor="middle" dominantBaseline="middle">15%</text>

                                <circle cx="20" cy="20" r="15.9155" fill="none" stroke="#2563eb" strokeWidth="8" strokeDasharray="25 75" strokeDashoffset="10"></circle>
                                <text x="35.6" y="22.5" className="text-[3px] font-bold fill-white txt-shadow font-sans text-center" textAnchor="middle" dominantBaseline="middle">25%</text>

                                <circle cx="20" cy="20" r="15.9155" fill="none" stroke="#d97706" strokeWidth="8" strokeDasharray="40 60" strokeDashoffset="-15"></circle>
                                <text x="10.5" y="32.8" className="text-[3px] font-bold fill-white txt-shadow font-sans text-center" textAnchor="middle" dominantBaseline="middle">40%</text>

                                <circle cx="20" cy="20" r="15.9155" fill="none" stroke="#dc2626" strokeWidth="8" strokeDasharray="20 80" strokeDashoffset="-55"></circle>
                                <text x="7.2" y="10.5" className="text-[3px] font-bold fill-white txt-shadow font-sans text-center" textAnchor="middle" dominantBaseline="middle">20%</text>
                            </svg>

                            <div className="grid grid-cols-2 gap-3 w-full mt-6 text-xs">
                                <div className="flex items-center font-medium text-slate-700"><div className="w-2.5 h-2.5 mr-2 rounded-full bg-[#16a34a]"></div> Muy Alta (Socios)</div>
                                <div className="flex items-center font-medium text-slate-700"><div className="w-2.5 h-2.5 mr-2 rounded-full bg-[#2563eb]"></div> Alta (Recurrentes)</div>
                                <div className="flex items-center font-medium text-slate-700"><div className="w-2.5 h-2.5 mr-2 rounded-full bg-[#d97706]"></div> Media (Oportunidad)</div>
                                <div className="flex items-center font-medium text-slate-700"><div className="w-2.5 h-2.5 mr-2 rounded-full bg-[#dc2626]"></div> Baja/Riesgo</div>
                            </div>
                        </div>
                    </div>
                </div>

                {/* Tabla Matriz */}
                <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm mb-8">
                    <h2 className="text-xl font-bold text-slate-900 mb-6 border-b border-slate-200 pb-4">Matriz de Probabilidad de Compra en 2026</h2>
                    <div className="overflow-x-auto">
                        <table className="w-full text-sm border-separate border-spacing-0">
                            <thead>
                                <tr>
                                    {['#', 'Cliente', 'Industria', 'Tendencia', 'Probabilidad'].map(h => (
                                        <th key={h} className="text-left px-4 py-3 bg-slate-50 text-slate-500 font-bold uppercase text-xs tracking-wider border-b border-slate-200 sticky top-0 z-10">{h}</th>
                                    ))}
                                </tr>
                            </thead>
                            <tbody>
                                {DATA_MATRIX.map(row => (
                                    <tr key={row.id} className="hover:bg-slate-50">
                                        <td className="px-4 py-3 border-b border-slate-200">{row.id}</td>
                                        <td className="px-4 py-3 border-b border-slate-200 font-bold">{row.client}</td>
                                        <td className="px-4 py-3 border-b border-slate-200">{row.ind}</td>
                                        <td className="px-4 py-3 border-b border-slate-200"><span className={row.trendClass}>{row.trend}</span></td>
                                        <td className="px-4 py-3 border-b border-slate-200">
                                            <span className={`px-2.5 py-1 rounded-full text-xs font-bold inline-block min-w-[50px] text-center ${row.badgeClass}`}>{row.prob}</span>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>

                <div className="text-center py-10 text-slate-500 text-xs border-t border-slate-200 mt-10">
                    &copy; 2026 Reporte Confidencial - Uso Interno Exclusivo
                </div>
            </div>
        );
    };

    // =========================================================
    // PESTA√ëA CXC (CUENTAS POR COBRAR - INTEGRADA)
    // =========================================================
    const TabCXC = () => {
        const CSV_URL_CXC = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRDisRq3SWEkwy5tZOAsCSB0rfmfQ8aCYgjdBhM7z7iKQ8BpHFpNYzLKzSRLnHVkId4vSEBj62X3TwQ/pub?output=csv';
        
        const COL = {
            ANIO: 'EJERCICIO',
            AGENCIA: 'AGENCIA O CLIENTE DIRECTO',
            CLIENTE: 'CLIENTE O CAMPA√ëA',
            ESTATUS: 'ESTATUS',
            MONTO_F: 'MONTO SIN IVA',
            MONTO_L: 'TOTAL FACTURADO'
        };

        const COLORS_CXC = {
            cobrado: '#10b981',   
            pendiente: '#ef4444', 
            riskMap: {
                'Al Corriente': '#22c55e', 
                'Bajo Riesgo': '#84cc16',  
                'Medio Riesgo': '#eab308', 
                'Alto Riesgo': '#f97316',  
                'Incobrable': '#ef4444',    
                'Sin Fecha': '#94a3b8'      
            }
        };

        // --- FUNCIONES AUXILIARES CXC ---
        const parseMoney = (val) => {
            if (!val) return 0;
            if (typeof val === 'number') return val;
            return parseFloat(val.toString().replace(/[$,\s]/g, '')) || 0;
        };

        const parseIntSafe = (val) => {
            if (!val) return 0;
            const num = parseInt(val, 10);
            return isNaN(num) ? 0 : num;
        };

        const formatMoney = (amount) => new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN', maximumFractionDigits: 0 }).format(amount);
        const formatMoneyShort = (value) => {
            if (value >= 1000000) return `$${(value / 1000000).toFixed(1)}M`;
            if (value >= 1000) return `$${(value / 1000).toFixed(0)}k`;
            return value;
        };

        const calculateAverageWithoutOutliers = (values) => {
            const positives = values.filter(v => v !== null && v > 0).sort((a, b) => a - b);
            if (positives.length === 0) return { avg: 0, count: 0 };
            if (positives.length < 4) { 
                const sum = positives.reduce((a, b) => a + b, 0);
                return { avg: Math.round(sum / positives.length), count: positives.length };
            }
            const q1 = positives[Math.floor(positives.length * 0.25)];
            const q3 = positives[Math.floor(positives.length * 0.75)];
            const iqr = q3 - q1;
            const upperFence = q3 + (1.5 * iqr); 
            const cleanValues = positives.filter(v => v <= upperFence);
            if (cleanValues.length === 0) return { avg: 0, count: 0 };
            const sum = cleanValues.reduce((a, b) => a + b, 0);
            return { avg: Math.round(sum / cleanValues.length), count: cleanValues.length };
        };

        const InfoIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-4 h-4">
                <path strokeLinecap="round" strokeLinejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
            </svg>
        );

        // Renombrado a CardCXC para no chocar con KpiCard de Ventas
        const CardCXC = ({ title, value, subtext, colorClass, infoText }) => (
            <div className={`card-pro p-6 border-l-4 ${colorClass} relative overflow-visible`}>
                <div className="flex justify-between items-start mb-2">
                    <p className="text-slate-500 text-xs font-bold uppercase tracking-widest">{title}</p>
                    {infoText && (
                        <div className="group relative ml-2">
                            <span className="cursor-help text-slate-400 hover:text-slate-600 transition-colors"><InfoIcon /></span>
                            <div className="invisible group-hover:visible opacity-0 group-hover:opacity-100 transition-opacity duration-200 absolute right-0 top-6 w-64 p-3 bg-slate-800 text-white text-[10px] leading-relaxed rounded-lg shadow-xl z-50 pointer-events-none">
                                <div className="absolute -top-1 right-1 w-2 h-2 bg-slate-800 rotate-45"></div>
                                <div className="relative z-10 whitespace-pre-line font-medium">{infoText}</div>
                            </div>
                        </div>
                    )}
                </div>
                <h3 className="text-3xl font-bold text-slate-800 tracking-tight">{value}</h3>
                {subtext && <p className="text-xs text-slate-400 mt-2 font-medium">{subtext}</p>}
            </div>
        );

        const [processedData, setProcessedData] = useState([]);
        const [loading, setLoading] = useState(true);
        const [error, setError] = useState(null);

        // Filtros y Paginaci√≥n
        const [filtroAnio, setFiltroAnio] = useState([]);
        const [busqueda, setBusqueda] = useState('');
        const [paginaActual, setPaginaActual] = useState(1);
        const filasPorPagina = 50;

        // Ordenamiento
        const [sortConfig, setSortConfig] = useState({ key: null, direction: 'asc' });

        useEffect(() => {
            const fetchData = () => {
                if (!Papa) {
                    setError("Librer√≠a PapaParse no cargada.");
                    setLoading(false);
                    return;
                }
                Papa.parse(CSV_URL_CXC, {
                    download: true,
                    header: true,
                    skipEmptyLines: true,
                    complete: (results) => {
                        if (results.data && results.meta && results.meta.fields) {
                            processRawData(results.data, results.meta.fields);
                        }
                        setLoading(false);
                    },
                    error: (err) => {
                        console.error(err);
                        setError("Error de conexi√≥n. Intenta recargar.");
                        setLoading(false);
                    }
                });
            };
            fetchData();
        }, []);

        const processRawData = (data, fields) => {
            const headerM = fields[12]; 
            const headerN = fields[13];
            const headerO = fields[14]; 
            const headerP = fields[15]; 

            const processed = data.map(row => {
                const montoF = parseMoney(row[COL.MONTO_F]);
                const montoL = parseMoney(row[COL.MONTO_L]);
                const estatusStr = (row[COL.ESTATUS] || '').toUpperCase();
                
                let esCobrado = false;
                let montoFinal = 0;

                if (montoL > 0) {
                    esCobrado = true;
                    montoFinal = montoL;
                } else if (estatusStr.includes('COBRADO')) {
                    esCobrado = true;
                    montoFinal = montoF;
                } else {
                    esCobrado = false;
                    montoFinal = montoF;
                }

                const diasVentaFact = parseIntSafe(row[headerM]); 
                const diasVentaCobro = parseIntSafe(row[headerN]);
                
                const rawP = row[headerP];
                let diasAntiguedadReal = 0;
                let esSinFecha = false;

                if (rawP && typeof rawP === 'string' && rawP.toUpperCase().includes('SIN FECHA')) {
                    esSinFecha = true;
                    diasAntiguedadReal = null; 
                } else {
                    diasAntiguedadReal = parseIntSafe(rawP);
                }

                let bucket = 'N/A';
                let bucketClass = '';
                
                if (!esCobrado) {
                    if (esSinFecha) {
                        bucket = 'Sin Fecha';
                        bucketClass = 'risk-sinfecha';
                    } else {
                        const d = diasAntiguedadReal;
                        if (d <= 30) { bucket = 'Al Corriente'; bucketClass = 'risk-corriente'; }
                        else if (d <= 60) { bucket = 'Bajo Riesgo'; bucketClass = 'risk-bajo'; }
                        else if (d <= 90) { bucket = 'Medio Riesgo'; bucketClass = 'risk-medio'; }
                        else if (d <= 180) { bucket = 'Alto Riesgo'; bucketClass = 'risk-alto'; }
                        else { bucket = 'Incobrable'; bucketClass = 'risk-incobrable'; }
                    }
                }

                return {
                    ...row,
                    _montoFinal: montoFinal,
                    _esCobrado: esCobrado,
                    _cliente: row[COL.CLIENTE] || row[COL.AGENCIA] || 'Desconocido',
                    _anio: row[COL.ANIO] || 'S/A',
                    _fechaStr: row[headerO] || '', 
                    _dVentaFact: diasVentaFact,
                    _dVentaCobro: diasVentaCobro,
                    _dAntiguedad: diasAntiguedadReal, 
                    _esSinFecha: esSinFecha,
                    _bucket: bucket,
                    _bucketClass: bucketClass
                };
            });
            setProcessedData(processed);
        };

        const dataFiltrada = useMemo(() => {
            return processedData.filter(row => {
                const passAnio = filtroAnio.length === 0 || filtroAnio.includes(row._anio);
                const passBusqueda = busqueda === '' || 
                                     JSON.stringify(row).toLowerCase().includes(busqueda.toLowerCase());
                return passAnio && passBusqueda;
            });
        }, [processedData, filtroAnio, busqueda]);

        const dataOrdenada = useMemo(() => {
            let items = [...dataFiltrada];
            if (sortConfig.key !== null) {
                items.sort((a, b) => {
                    let aValue = a[sortConfig.key];
                    let bValue = b[sortConfig.key];
                    if (aValue === null) aValue = -999999;
                    if (bValue === null) bValue = -999999;
                    if (aValue < bValue) return sortConfig.direction === 'asc' ? -1 : 1;
                    if (aValue > bValue) return sortConfig.direction === 'asc' ? 1 : -1;
                    return 0;
                });
            }
            return items;
        }, [dataFiltrada, sortConfig]);

        const requestSort = (key) => {
            let direction = 'asc';
            if (sortConfig.key === key && sortConfig.direction === 'asc') direction = 'desc';
            setSortConfig({ key, direction });
            setPaginaActual(1);
        };

        const getSortIcon = (key) => {
            if (sortConfig.key !== key) return <span className="text-slate-300 ml-1">‚Üï</span>;
            return sortConfig.direction === 'asc' ? <span className="text-rose-600 ml-1">‚Üë</span> : <span className="text-rose-600 ml-1">‚Üì</span>;
        };

        const kpis = useMemo(() => {
            const totalCobrado = dataFiltrada.filter(r => r._esCobrado).reduce((acc, r) => acc + r._montoFinal, 0);
            const totalPendiente = dataFiltrada.filter(r => !r._esCobrado).reduce((acc, r) => acc + r._montoFinal, 0);
            const total = totalCobrado + totalPendiente;
            const porcentaje = total > 0 ? (totalCobrado / total) * 100 : 0;
            return { totalCobrado, totalPendiente, porcentaje };
        }, [dataFiltrada]);

        const timeKpis = useMemo(() => {
            const valuesM = dataFiltrada.map(r => r._dVentaFact);
            const statsM = calculateAverageWithoutOutliers(valuesM);
            const valuesN = dataFiltrada.filter(r => r._esCobrado).map(r => r._dVentaCobro);
            const statsN = calculateAverageWithoutOutliers(valuesN);
            return { avgFact: statsM.avg, countFact: statsM.count, avgCobro: statsN.avg, countCobro: statsN.count };
        }, [dataFiltrada]);

        const chartsData = useMemo(() => {
            const pieData = [ { name: 'Cobrado', value: kpis.totalCobrado }, { name: 'Pendiente', value: kpis.totalPendiente } ];
            const deudaPorCliente = {};
            dataFiltrada.forEach(row => { if (!row._esCobrado) { let nombre = row._cliente; deudaPorCliente[nombre] = (deudaPorCliente[nombre] || 0) + row._montoFinal; } });
            const topDeudores = Object.keys(deudaPorCliente).map(key => ({ name: key, deuda: deudaPorCliente[key] })).sort((a, b) => b.deuda - a.deuda).slice(0, 10);
            const bucketOrder = ['Al Corriente', 'Bajo Riesgo', 'Medio Riesgo', 'Alto Riesgo', 'Incobrable', 'Sin Fecha'];
            const buckets = {}; bucketOrder.forEach(b => buckets[b] = 0);
            dataFiltrada.forEach(r => { if (!r._esCobrado && r._bucket !== 'N/A') { buckets[r._bucket] += r._montoFinal; } });
            const agingData = bucketOrder.map(k => ({ name: k, value: buckets[k], fill: COLORS_CXC.riskMap[k] })).filter(item => item.value > 0);
            return { pieData, topDeudores, agingData };
        }, [dataFiltrada, kpis]);

        const listaAnios = useMemo(() => [...new Set(processedData.map(r => r._anio))].sort().reverse(), [processedData]);
        const toggleAnio = (anio) => { setFiltroAnio(prev => prev.includes(anio) ? prev.filter(a => a !== anio) : [...prev, anio]); setPaginaActual(1); };

        const dataTablaPaginada = useMemo(() => {
            const inicio = (paginaActual - 1) * filasPorPagina;
            return dataOrdenada.slice(inicio, inicio + filasPorPagina);
        }, [dataOrdenada, paginaActual]);
        
        const totalPaginas = Math.ceil(dataOrdenada.length / filasPorPagina);

        if (loading) return <div className="min-h-[60vh] flex flex-col items-center justify-center"><div className="spinner mb-4"></div><p className="text-slate-500 font-medium animate-pulse">Cargando datos CXC...</p></div>;
        if (error) return <div className="min-h-[60vh] flex items-center justify-center text-red-600 font-bold max-w-lg mx-auto text-center px-4">{error}</div>;

        return (
            <div className="fade-in p-6 md:p-12 max-w-[1600px] mx-auto min-h-screen">
                
                {/* Header CXC */}
                <header className="mb-10 flex flex-col md:flex-row justify-between items-end border-b border-slate-200 pb-6">
                    <div>
                        <h1 className="text-3xl font-bold text-slate-800 tracking-tight">An√°lisis de Cobranza (CXC)</h1>
                        <p className="text-slate-500 mt-1 text-sm font-medium">Estado de Cuenta y Riesgo</p>
                    </div>
                    <div className="mt-4 md:mt-0 flex flex-wrap gap-2 justify-end">
                            <div className="flex items-center gap-2">
                            <span className="text-xs font-bold text-slate-400 uppercase mr-2">A√±o:</span>
                            {listaAnios.map(anio => (
                                <button key={anio} onClick={() => toggleAnio(anio)}
                                    className={`px-3 py-1 rounded-full text-xs font-bold transition-all ${filtroAnio.includes(anio) ? 'bg-violet-600 text-white shadow-md' : 'bg-white border border-slate-200 text-slate-500 hover:bg-slate-50'}`}>
                                    {anio}
                                </button>
                            ))}
                        </div>
                    </div>
                </header>

                {/* KPIs Principales */}
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
                    <CardCXC 
                        title="Total Cobrado" 
                        value={formatMoney(kpis.totalCobrado)} 
                        subtext="Suma de facturaci√≥n real" 
                        colorClass="border-emerald-500"
                        infoText={`1. Usa "TOTAL FACTURADO" (Col L), si es > 0.\n2. Si no hay dato, usa "MONTO SIN IVA" si el estatus dice "COBRADO".`}
                    />
                    <CardCXC 
                        title="Total Pendiente (Deuda)" 
                        value={formatMoney(kpis.totalPendiente)} 
                        subtext="Monto no cobrado" 
                        colorClass="border-rose-500" 
                        infoText={`Suma del "MONTO SIN IVA" de las cuentas abiertas.\n\nSe incluye si:\n1. "TOTAL FACTURADO" es 0 o vac√≠o.\n2. ESTATUS no indica "COBRADO".`}
                    />
                    <CardCXC title="% Recuperaci√≥n" value={kpis.porcentaje.toFixed(1) + '%'} subtext="Eficiencia de cobro" colorClass="border-blue-500" />
                </div>

                {/* --- SECCI√ìN: CICLO DE EFECTIVO --- */}
                <div className="mb-8">
                    <h2 className="text-xl font-bold text-slate-700 mb-4 flex items-center gap-2">
                        <span className="w-1 h-6 bg-amber-500 rounded"></span> 
                        Ciclo de Conversi√≥n y Riesgo
                    </h2>
                    <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
                        <CardCXC title="Promedio: Venta ‚Üí Factura" value={`${timeKpis.avgFact} D√≠as`} subtext="Operatividad interna" colorClass="border-indigo-400" />
                        <CardCXC title="Promedio: Venta ‚Üí Cobro" value={`${timeKpis.avgCobro} D√≠as`} subtext="Ciclo de pago cliente" colorClass="border-violet-400" />
                        <div className="lg:col-span-2 card-pro p-6">
                            <h3 className="text-xs font-bold text-slate-500 uppercase mb-4">Matriz de Riesgo (D√≠as Antig√ºedad)</h3>
                            <div className="h-40 w-full">
                                <ResponsiveContainer>
                                    <BarChart data={chartsData.agingData} layout="vertical">
                                        <CartesianGrid strokeDasharray="3 3" horizontal={false} />
                                        <XAxis type="number" hide />
                                        <YAxis dataKey="name" type="category" width={100} tick={{fontSize:10}} />
                                        <Tooltip formatter={(val) => formatMoney(val)} />
                                        <Bar dataKey="value" radius={[0,4,4,0]}>
                                            {chartsData.agingData.map((entry, index) => ( <Cell key={`cell-${index}`} fill={entry.fill} /> ))}
                                            <LabelList dataKey="value" position="right" formatter={formatMoneyShort} style={{fontSize:10, fontWeight:'bold', fill:'#64748b'}} />
                                        </Bar>
                                    </BarChart>
                                </ResponsiveContainer>
                            </div>
                        </div>
                    </div>
                </div>

                {/* Gr√°ficas Originales */}
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-10">
                    <div className="card-pro p-6 lg:col-span-1 flex flex-col">
                        <h3 className="text-sm font-bold text-slate-700 uppercase mb-4">Composici√≥n de Cartera</h3>
                        <div className="flex-1 min-h-[250px]">
                            <ResponsiveContainer width="100%" height="100%">
                                <PieChart>
                                    <Pie data={chartsData.pieData} cx="50%" cy="50%" innerRadius={60} outerRadius={80} paddingAngle={5} dataKey="value">
                                        <Cell fill={COLORS_CXC.cobrado} /> <Cell fill={COLORS_CXC.pendiente} />
                                    </Pie>
                                    <Tooltip formatter={(val) => formatMoney(val)} />
                                    <Legend verticalAlign="bottom" height={36}/>
                                </PieChart>
                            </ResponsiveContainer>
                        </div>
                    </div>
                    <div className="card-pro p-6 lg:col-span-2 flex flex-col">
                        <h3 className="text-sm font-bold text-slate-700 uppercase mb-4">Top 10 Clientes con Deuda</h3>
                        <div className="flex-1 min-h-[350px]">
                            <ResponsiveContainer width="100%" height="100%">
                                <BarChart data={chartsData.topDeudores} layout="vertical" margin={{top: 5, right: 50, left: 20, bottom: 5}}>
                                    <CartesianGrid strokeDasharray="3 3" horizontal={false} stroke="#e2e8f0"/>
                                    <XAxis type="number" hide />
                                    <YAxis dataKey="name" type="category" width={230} tick={{fontSize: 11, fill: '#475569'}} interval={0} />
                                    <Tooltip formatter={(val) => formatMoney(val)} cursor={{fill: '#fef2f2'}} />
                                    <Bar dataKey="deuda" fill={COLORS_CXC.pendiente} radius={[0, 4, 4, 0]}>
                                        <LabelList dataKey="deuda" position="right" formatter={formatMoneyShort} style={{fontSize: '11px', fontWeight: 'bold', fill: '#be123c'}} />
                                    </Bar>
                                </BarChart>
                            </ResponsiveContainer>
                        </div>
                    </div>
                </div>

                {/* Tabla Detallada */}
                <div className="card-pro overflow-hidden">
                    <div className="p-4 border-b border-slate-100 bg-slate-50/50 flex flex-col sm:flex-row justify-between items-center gap-4">
                        <h3 className="text-sm font-bold text-slate-700 uppercase">Detalle Operativo</h3>
                        <div className="relative w-full sm:w-auto">
                            <input type="text" placeholder="Buscar..." className="pl-8 pr-4 py-2 text-xs border border-slate-300 rounded-lg w-full sm:w-64 outline-none"
                                value={busqueda} onChange={(e) => { setBusqueda(e.target.value); setPaginaActual(1); }} />
                            <span className="absolute left-2.5 top-2 text-slate-400">üîç</span>
                        </div>
                    </div>
                    <div className="overflow-x-auto">
                        <table className="w-full text-left text-xs whitespace-nowrap">
                            <thead className="bg-slate-50 text-slate-500 font-bold uppercase tracking-wider">
                                <tr>
                                    <th className="px-6 py-4 sortable" onClick={() => requestSort('_fechaStr')}>
                                        Fecha {getSortIcon('_fechaStr')}
                                    </th>
                                    <th className="px-6 py-4 sortable" onClick={() => requestSort('_cliente')}>
                                        Cliente {getSortIcon('_cliente')}
                                    </th>
                                    <th className="px-6 py-4 text-right sortable" onClick={() => requestSort('_montoFinal')}>
                                        Monto {getSortIcon('_montoFinal')}
                                    </th>
                                    <th className="px-6 py-4 text-center sortable" onClick={() => requestSort('_esCobrado')}>
                                        Estado {getSortIcon('_esCobrado')}
                                    </th>
                                    <th className="px-6 py-4 text-center sortable" onClick={() => requestSort('_dVentaFact')}>
                                        Ciclo {getSortIcon('_dVentaFact')}
                                    </th>
                                    <th className="px-6 py-4 text-center sortable" onClick={() => requestSort('_dAntiguedad')}>
                                        Riesgo {getSortIcon('_dAntiguedad')}
                                    </th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-slate-100 bg-white">
                                {dataTablaPaginada.map((row, i) => (
                                    <tr key={i} className="hover:bg-slate-50 transition-colors">
                                        <td className="px-6 py-3 text-slate-600">
                                            {row._fechaStr || '-'}
                                        </td>
                                        <td className="px-6 py-3">
                                            <div className="font-bold text-slate-700 truncate max-w-[200px]" title={row._cliente}>{row._cliente}</div>
                                            <div className="text-[10px] text-slate-400 truncate max-w-[200px]">{row[COL.AGENCIA]}</div>
                                        </td>
                                        <td className="px-6 py-3 text-right font-bold text-slate-800">${row._montoFinal.toLocaleString()}</td>
                                        <td className="px-6 py-3 text-center">
                                            <span className={`status-badge ${row._esCobrado ? 'st-cobrado' : 'st-pendiente'}`}>
                                                {row._esCobrado ? 'COBRADO' : 'PENDIENTE'}
                                            </span>
                                        </td>
                                        <td className="px-6 py-3 text-center text-slate-500">
                                             <div className="flex flex-col text-[10px]">
                                                <span>V‚ÜíF: <b>{row._dVentaFact}</b></span>
                                                <span>V‚ÜíC: <b>{row._dVentaCobro}</b></span>
                                             </div>
                                        </td>
                                        <td className="px-6 py-3 text-center">
                                            {!row._esCobrado && row._bucket !== 'N/A' ? (
                                                <span className={`status-badge ${row._bucketClass}`}>
                                                    {row._esSinFecha ? 'Sin Fecha' : `${row._bucket} (${row._dAntiguedad}d)`}
                                                </span>
                                            ) : '-'}
                                        </td>
                                    </tr>
                                ))}
                                {dataTablaPaginada.length === 0 && <tr><td colSpan="6" className="px-6 py-8 text-center text-slate-400">Sin datos.</td></tr>}
                            </tbody>
                        </table>
                    </div>
                    <div className="p-4 border-t border-slate-100 flex justify-between items-center bg-slate-50/50">
                        <button onClick={() => setPaginaActual(p => Math.max(1, p - 1))} disabled={paginaActual === 1} className="px-3 py-1 text-xs font-bold text-slate-600 bg-white border border-slate-200 rounded disabled:opacity-50">Anterior</button>
                        <span className="text-xs text-slate-500">P√°g {paginaActual} de {totalPaginas}</span>
                        <button onClick={() => setPaginaActual(p => Math.min(totalPaginas, p + 1))} disabled={paginaActual === totalPaginas} className="px-3 py-1 text-xs font-bold text-slate-600 bg-white border border-slate-200 rounded disabled:opacity-50">Siguiente</button>
                    </div>
                </div>
            </div>
        );
    };

    // =========================================================
    // PESTA√ëA VENTAS (Original)
    // =========================================================
    const TabSales = () => {
        // CONFIGURACI√ìN
        const SPREADSHEET_ID = '1Ylk3tn1yQcdnDHFrskYvxdJYrKP_PoxtHulu4jMl8uA';
        const TAB_1 = 'Data Pesta√±as';      
        const TAB_2 = 'Campa√±as MX 2025';   
        
        const COLUMNA_COSTO = 'COSTO'; 
        const COLUMNA_VENDEDOR = 'VENDEDOR'; 
        const COLUMNA_MES = 'MES';
        const COLUMNA_UDN = 'UDN';
        const COLUMNA_CONTENIDO = 'CONTENIDO';
        const COLUMNA_CLIENTE = 'CLIENTE';

        const COLORS = {
            primary: '#be123c', secondary: '#fb7185', accent: '#9f1239', inactive: '#e2e8f0',
            gaugeRed: '#ef4444', gaugeYellow: '#f59e0b', gaugeGreen: '#10b981'
        };

        const COLUMNAS_TABLA = ['MES', 'VENDEDOR', 'CLIENTE', 'NOMBRE DE LA CAMPANA', 'ESTATUS', 'COSTO', 'FECHA INICIO', 'FECHA FIN', 'DIAS'];
        const METAS_DETALLADAS = {
            "ANGELA RAMIREZ": [332010, 422220, 576600, 581064, 761484, 796080, 634260, 662160, 736560, 736560, 585900, 783060],
            "CLAUDIA RAMIREZ": [353430, 449460, 613800, 695242, 810612, 847440, 813674, 843374, 922574, 911933, 751553, 961433],
            "MARIANA GONZALEZ": [310590, 394980, 539400, 653321, 822101, 854465, 778490, 804590, 874190, 859634, 843231, 849231],
            "MITZI VERA": [235620, 299640, 409200, 482521, 610561, 635113, 583939, 603739, 656539, 723449, 616529, 756449],
            "ERIK FINKENTHAL": [300000, 204000, 366937, 418140, 476200, 403328, 437272, 347292, 437576, 0, 0, 0], 
            "ZINNIA SANCHEZ": [400000, 414000, 418000, 805000, 845000, 754220, 734639, 693222, 711069, 320000, 430000, 450000],
            "CLAUDIA SALDANA": [272420, 263110, 266000, 555146, 420779, 445000, 437272, 347292, 437576, 370000, 390000, 550000],
            "NADIA": [0, 0, 0, 272420, 263110, 266000, 594423, 607242, 484614, 0, 0, 0], 
            "HORACIO": [300000, 550000, 600000, 650000, 700000, 700000, 800000, 800000, 800000, 700000, 700000, 700000]
        };

        const getMesIndex = (nombreMes) => {
            if (!nombreMes) return -1;
            const meses = ['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio', 'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'];
            return meses.indexOf(nombreMes.toLowerCase().trim());
        };

        const formatMoneyShort = (value) => {
            if (value >= 1000000) return `$${(value / 1000000).toFixed(1)}M`;
            if (value >= 1000) return `$${(value / 1000).toFixed(0)}k`;
            return value;
        };

        const formatMoney = (amount) => new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN', maximumFractionDigits: 0 }).format(amount);
        const formatPercent = (val) => val.toFixed(1) + '%';

        const KpiCard = ({ title, value, icon, subtext = "" }) => (
            <div className="card-pro p-6 flex flex-col justify-between h-full relative overflow-hidden border-l-4 border-rose-600">
                <div className="flex justify-between items-start mb-4">
                    <div>
                        <p className="text-slate-500 text-xs font-bold uppercase tracking-widest mb-1">{title}</p>
                        <h3 className="text-2xl font-bold text-slate-800 tracking-tight">{value}</h3>
                    </div>
                    <div className="p-2 rounded-full bg-rose-50 text-rose-600">{icon}</div>
                </div>
                {subtext && <div className="text-xs text-slate-400 font-medium border-t border-slate-100 pt-2 mt-auto">{subtext}</div>}
            </div>
        );

        const GaugeChart = ({ nombre, vendido, meta, filtrosMes }) => {
            const porcentaje = meta > 0 ? (vendido / meta) * 100 : 0;
            const visualValue = Math.min(porcentaje, 100);
            
            let color = COLORS.gaugeRed; 
            if (porcentaje >= 50) color = COLORS.gaugeYellow; 
            if (porcentaje >= 90) color = COLORS.gaugeGreen; 
            
            const data = [{ name: 'Progress', value: visualValue }, { name: 'Remaining', value: 100 - visualValue }];
            const labelMeta = filtrosMes && filtrosMes.length > 0 ? `META (${filtrosMes.length} MESES)` : 'META ANUAL';

            return (
                <div className="card-pro p-6 flex flex-col items-center relative">
                    <div className="w-full flex justify-between items-center mb-1 border-b border-slate-100 pb-2">
                        <h4 className="text-xs font-bold text-slate-700 uppercase tracking-wider truncate mr-2" title={nombre}>{nombre}</h4>
                        {porcentaje >= 100 && <span className="bg-emerald-100 text-emerald-800 text-[9px] px-2 py-0.5 rounded-full font-bold tracking-wide">CUMPLIDO</span>}
                    </div>
                    <div className="gauge-container mt-2">
                        <ResponsiveContainer width="100%" height="100%">
                            <PieChart>
                                <Pie data={data} cx="50%" cy="100%" startAngle={180} endAngle={0} innerRadius="78%" outerRadius="100%" paddingAngle={0} dataKey="value" stroke="none">
                                    <Cell fill={color} />
                                    <Cell fill="#f1f5f9" />
                                </Pie>
                            </PieChart>
                        </ResponsiveContainer>
                        <div className="gauge-value"><span className="text-xl font-bold tracking-tight" style={{color: color}}>{porcentaje.toFixed(1)}%</span></div>
                    </div>
                    <div className="w-full mt-2 pt-2 grid grid-cols-2 gap-2 text-[10px]">
                        <div><p className="text-slate-400 font-bold uppercase">Vendido</p><p className="font-semibold text-slate-700 text-xs">{formatMoney(vendido)}</p></div>
                        <div className="text-right"><p className="text-slate-400 font-bold uppercase">{labelMeta}</p><p className="font-semibold text-slate-700 text-xs">{formatMoney(meta)}</p></div>
                    </div>
                </div>
            );
        };

        const [rawData1, setRawData1] = useState([]); 
        const [rawData2, setRawData2] = useState([]); 
        
        const [filtrosVendedor, setFiltrosVendedor] = useState([]); 
        const [filtrosMes, setFiltrosMes] = useState([]); 
        const [filtrosUDN, setFiltrosUDN] = useState([]); 
        
        const [busquedaCliente, setBusquedaCliente] = useState('');
        const [paginaActual, setPaginaActual] = useState(1);
        const registrosPorPagina = 20;

        const [loading, setLoading] = useState(true);
        const [error, setError] = useState(null);

        useEffect(() => {
            const fetchData = async () => {
                try {
                    const url1 = `https://opensheet.elk.sh/${SPREADSHEET_ID}/${encodeURIComponent(TAB_1)}`;
                    const url2 = `https://opensheet.elk.sh/${SPREADSHEET_ID}/${encodeURIComponent(TAB_2)}`;
                    const [res1, res2] = await Promise.all([fetch(url1), fetch(url2)]);
                    if (!res1.ok || !res2.ok) throw new Error("Error conectando con Google Sheets");
                    const json1 = await res1.json();
                    const json2 = await res2.json();
                    setRawData1(json1);
                    setRawData2(json2);
                    setLoading(false);
                } catch (err) {
                    console.error(err);
                    setError(err.message);
                    setLoading(false);
                }
            };
            fetchData();
        }, []);

        const toggleFiltro = (setFunction, valor) => {
            setFunction(prev => prev.includes(valor) ? prev.filter(item => item !== valor) : [...prev, valor]);
            setPaginaActual(1);
        };

        const limpiarFiltros = () => {
            setFiltrosVendedor([]);
            setFiltrosMes([]);
            setFiltrosUDN([]);
            setBusquedaCliente('');
            setPaginaActual(1);
        };

        const filtrarDatosGlobales = (datos) => {
            return datos.filter(row => {
                const passVendedor = filtrosVendedor.length === 0 || filtrosVendedor.includes(row[COLUMNA_VENDEDOR]);
                const passMes = filtrosMes.length === 0 || filtrosMes.includes(row[COLUMNA_MES]);
                const passUDN = filtrosUDN.length === 0 || filtrosUDN.includes(row[COLUMNA_UDN]);
                return passVendedor && passMes && passUDN;
            });
        };

        const data1 = useMemo(() => filtrarDatosGlobales(rawData1), [rawData1, filtrosVendedor, filtrosMes, filtrosUDN]);
        const data2 = useMemo(() => filtrarDatosGlobales(rawData2), [rawData2, filtrosVendedor, filtrosMes, filtrosUDN]);

        const dataTablaFiltrada = useMemo(() => {
            if (!busquedaCliente) return data2;
            return data2.filter(row => {
                const cliente = row[COLUMNA_CLIENTE] ? row[COLUMNA_CLIENTE].toString().toLowerCase() : '';
                return cliente.includes(busquedaCliente.toLowerCase());
            });
        }, [data2, busquedaCliente]);

        const totalPaginas = Math.ceil(dataTablaFiltrada.length / registrosPorPagina);
        const dataTablaPaginada = useMemo(() => {
            const inicio = (paginaActual - 1) * registrosPorPagina;
            const fin = inicio + registrosPorPagina;
            return dataTablaFiltrada.slice(inicio, fin);
        }, [dataTablaFiltrada, paginaActual]);

        const cambiarPagina = (direccion) => {
            if (direccion === 'next' && paginaActual < totalPaginas) {
                setPaginaActual(prev => prev + 1);
            } else if (direccion === 'prev' && paginaActual > 1) {
                setPaginaActual(prev => prev - 1);
            }
        };

        const sumarColumna = (dataset, nombreColumna) => {
            if (!dataset || dataset.length === 0) return 0;
            return dataset.reduce((acumulado, fila) => {
                let valor = fila[nombreColumna];
                if (!valor) return acumulado;
                if (typeof valor === 'string') valor = valor.replace(/[^0-9.-]+/g,"");
                return acumulado + (parseFloat(valor) || 0);
            }, 0);
        };

        const countPropuestas = data1.length;
        const countCerradas = data2.length;
        const montoPropuestas = sumarColumna(data1, COLUMNA_COSTO);
        const montoVentas = sumarColumna(data2, COLUMNA_COSTO);
        const tasaConversionQty = countPropuestas > 0 ? (countCerradas / countPropuestas) * 100 : 0;
        const tasaConversionMonto = montoPropuestas > 0 ? (montoVentas / montoPropuestas) * 100 : 0;

        const getBaseDataVendedores = () => rawData2.filter(row => 
            (filtrosMes.length === 0 || filtrosMes.includes(row[COLUMNA_MES])) &&
            (filtrosUDN.length === 0 || filtrosUDN.includes(row[COLUMNA_UDN]))
        );

        const datosVendedoresCantidad = useMemo(() => {
            const baseData = getBaseDataVendedores();
            const conteo = baseData.reduce((acc, row) => {
                const vendedor = row[COLUMNA_VENDEDOR] || 'Sin Asignar';
                acc[vendedor] = (acc[vendedor] || 0) + 1;
                return acc;
            }, {});
            return Object.keys(conteo).map(key => ({ name: key, valor: conteo[key] })).sort((a, b) => b.valor - a.valor);
        }, [rawData2, filtrosMes, filtrosUDN]);

        const datosVendedoresMonto = useMemo(() => {
            const baseData = getBaseDataVendedores();
            const suma = baseData.reduce((acc, row) => {
                const vendedor = row[COLUMNA_VENDEDOR] || 'Sin Asignar';
                let valor = row[COLUMNA_COSTO];
                if (typeof valor === 'string') valor = parseFloat(valor.replace(/[^0-9.-]+/g,""));
                acc[vendedor] = (acc[vendedor] || 0) + (valor || 0);
                return acc;
            }, {});
            return Object.keys(suma).map(key => ({ name: key, valor: suma[key] })).sort((a, b) => b.valor - a.valor);
        }, [rawData2, filtrosMes, filtrosUDN]);

        const getBaseDataMeses = () => rawData2.filter(row => 
            (filtrosVendedor.length === 0 || filtrosVendedor.includes(row[COLUMNA_VENDEDOR])) &&
            (filtrosUDN.length === 0 || filtrosUDN.includes(row[COLUMNA_UDN]))
        );

        const datosMesesCantidad = useMemo(() => {
            const baseData = getBaseDataMeses();
            const conteo = baseData.reduce((acc, row) => {
                const mes = row[COLUMNA_MES] || 'Sin Fecha';
                acc[mes] = (acc[mes] || 0) + 1;
                return acc;
            }, {});
            const ordenMeses = ['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio', 'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'];
            return Object.keys(conteo).map(key => ({ name: key, valor: conteo[key] })).sort((a, b) => {
                const idxA = ordenMeses.indexOf(a.name.toLowerCase());
                const idxB = ordenMeses.indexOf(b.name.toLowerCase());
                return (idxA !== -1 && idxB !== -1) ? idxA - idxB : 0;
            });
        }, [rawData2, filtrosVendedor, filtrosUDN]);

        const datosMesesMonto = useMemo(() => {
            const baseData = getBaseDataMeses();
            const suma = baseData.reduce((acc, row) => {
                const mes = row[COLUMNA_MES] || 'Sin Fecha';
                let valor = row[COLUMNA_COSTO];
                if (typeof valor === 'string') valor = parseFloat(valor.replace(/[^0-9.-]+/g,""));
                acc[mes] = (acc[mes] || 0) + (valor || 0);
                return acc;
            }, {});
            const ordenMeses = ['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio', 'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'];
            return Object.keys(suma).map(key => ({ name: key, valor: suma[key] })).sort((a, b) => {
                const idxA = ordenMeses.indexOf(a.name.toLowerCase());
                const idxB = ordenMeses.indexOf(b.name.toLowerCase());
                return (idxA !== -1 && idxB !== -1) ? idxA - idxB : 0;
            });
        }, [rawData2, filtrosVendedor, filtrosUDN]);

        const datosUDNMonto = useMemo(() => {
            const baseData = rawData2.filter(row => 
                (filtrosVendedor.length === 0 || filtrosVendedor.includes(row[COLUMNA_VENDEDOR])) &&
                (filtrosMes.length === 0 || filtrosMes.includes(row[COLUMNA_MES]))
            );
            const suma = baseData.reduce((acc, row) => {
                const udn = row[COLUMNA_UDN] || 'Sin UDN';
                let valor = row[COLUMNA_COSTO];
                if (typeof valor === 'string') valor = parseFloat(valor.replace(/[^0-9.-]+/g,""));
                acc[udn] = (acc[udn] || 0) + (valor || 0);
                return acc;
            }, {});
            return Object.keys(suma).map(key => ({ name: key, valor: suma[key] })).sort((a, b) => b.valor - a.valor);
        }, [rawData2, filtrosVendedor, filtrosMes]);

        const datosTopContenido = useMemo(() => {
            const baseData = data2; 
            const suma = baseData.reduce((acc, row) => {
                const contenido = row[COLUMNA_CONTENIDO] || 'Sin Contenido';
                let valor = row[COLUMNA_COSTO];
                if (typeof valor === 'string') valor = parseFloat(valor.replace(/[^0-9.-]+/g,""));
                acc[contenido] = (acc[contenido] || 0) + (valor || 0);
                return acc;
            }, {});
            return Object.keys(suma)
                .map(key => ({ name: key, valor: suma[key] }))
                .sort((a, b) => b.valor - a.valor)
                .slice(0, 10);
        }, [data2]);

        const datosAcelerometros = useMemo(() => {
            const ventasPorVendedor = {};
            data2.forEach(row => {
                const nombreSheet = row[COLUMNA_VENDEDOR];
                let valor = row[COLUMNA_COSTO];
                if (typeof valor === 'string') valor = parseFloat(valor.replace(/[^0-9.-]+/g,""));
                if (nombreSheet) {
                    const nombreNorm = nombreSheet.trim().toUpperCase();
                    ventasPorVendedor[nombreNorm] = (ventasPorVendedor[nombreNorm] || 0) + (valor || 0);
                }
            });

            return Object.keys(METAS_DETALLADAS).map(nombreMeta => {
                const nombreNorm = nombreMeta.toUpperCase();
                let vendido = 0;
                const matchKey = Object.keys(ventasPorVendedor).find(k => k.includes(nombreNorm) || nombreNorm.includes(k));
                if (matchKey) vendido = ventasPorVendedor[matchKey];

                const metasArray = METAS_DETALLADAS[nombreMeta];
                let metaTotal = 0;
                if (filtrosMes.length > 0) {
                      filtrosMes.forEach(mesNombre => {
                          const idx = getMesIndex(mesNombre);
                          if (idx !== -1) metaTotal += metasArray[idx];
                      });
                } else {
                    metaTotal = metasArray.reduce((a, b) => a + b, 0);
                }
                return { nombre: nombreMeta, meta: metaTotal, vendido: vendido };
            }).sort((a, b) => b.vendido - a.vendido);
        }, [data2, filtrosMes]);

        const getBarColor = (name, filtrosActivos, activeColor, inactiveColor) => {
            if (filtrosActivos.length === 0) return activeColor;
            return filtrosActivos.includes(name) ? activeColor : inactiveColor;
        };

        const hayFiltrosActivos = filtrosVendedor.length > 0 || filtrosMes.length > 0 || filtrosUDN.length > 0;
        const acelerometrosVisibles = datosAcelerometros.filter(v => {
            if (!hayFiltrosActivos) return true; 
            return v.vendido > 0; 
        });

        if (loading) return <div className="h-screen flex flex-col items-center justify-center bg-slate-50"><div className="spinner mb-4"></div><p className="text-slate-500 font-medium animate-pulse text-sm">Sincronizando datos...</p></div>;
        if (error) return <div className="h-screen flex items-center justify-center text-red-600 font-bold">{error}</div>;

        // Iconos
        const IconCheck = <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>;
        const IconFile = <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>;
        const IconMoney = <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>;
        const IconPercent = <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="19" y1="5" x2="5" y2="19"></line><circle cx="6.5" cy="6.5" r="2.5"></circle><circle cx="17.5" cy="17.5" r="2.5"></circle></svg>;
        const IconFunnel = <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg>;
        const IconSearch = <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>;

        return (
            <div className="fade-in p-6 md:p-12 max-w-[1600px] mx-auto min-h-screen">
                
                {/* HEADER */}
                <header className="mb-10 pb-6 flex flex-col md:flex-row justify-between items-end border-b border-slate-200 bg-white p-6 -mx-6 md:-mx-12 -mt-6 md:-mt-12 sticky top-0 z-50 shadow-sm">
                    <div>
                        <h1 className="text-3xl font-bold text-slate-800 tracking-tight">Dashboard Ejecutivo 2025</h1>
                        <p className="text-slate-500 mt-1 text-sm font-medium">Control Financiero y Comercial</p>
                    </div>
                    <div className="text-right flex flex-col items-end gap-2 mt-4 md:mt-0">
                        {(filtrosVendedor.length > 0 || filtrosMes.length > 0 || filtrosUDN.length > 0) && (
                            <button onClick={limpiarFiltros} className="text-xs text-rose-600 font-bold hover:text-rose-800 mb-1 transition-colors flex items-center">
                                <span className="mr-1">‚úï</span> Borrar Filtros
                            </button>
                        )}
                        <div className="flex flex-wrap justify-end gap-2">
                            {filtrosVendedor.map(v => (
                                <span key={v} onClick={() => toggleFiltro(setFiltrosVendedor, v)} className="bg-rose-700 text-white px-3 py-1 rounded-md text-xs font-semibold cursor-pointer hover:bg-slate-700 transition-colors shadow-sm">{v} ‚úï</span>
                            ))}
                            {filtrosMes.map(m => (
                                <span key={m} onClick={() => toggleFiltro(setFiltrosMes, m)} className="bg-slate-600 text-white px-3 py-1 rounded-md text-xs font-semibold cursor-pointer hover:bg-rose-700 transition-colors shadow-sm">{m} ‚úï</span>
                            ))}
                            {filtrosUDN.map(u => (
                                <span key={u} onClick={() => toggleFiltro(setFiltrosUDN, u)} className="bg-rose-500 text-white px-3 py-1 rounded-md text-xs font-semibold cursor-pointer hover:bg-slate-700 transition-colors shadow-sm">{u} ‚úï</span>
                            ))}
                            {!hayFiltrosActivos && (
                                <span className="bg-slate-50 border border-slate-200 text-slate-400 px-3 py-1 rounded-md text-xs font-bold uppercase tracking-wider">Vista General</span>
                            )}
                        </div>
                    </div>
                </header>

                {/* KPIs */}
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
                    <KpiCard title="Campa√±as Vendidas" value={countCerradas} icon={IconCheck} subtext="Total acumulado" />
                    <KpiCard title="Monto Ventas" value={formatMoney(montoVentas)} icon={IconMoney} subtext="Ingreso real (Costo)" />
                    <KpiCard title="Tasa Conversi√≥n (Campa√±as)" value={formatPercent(tasaConversionQty)} icon={IconFunnel} subtext="Eficiencia operativa" />
                    <KpiCard title="Campa√±as Propuestas" value={countPropuestas} icon={IconFile} subtext="Total en pipeline" />
                    <KpiCard title="Monto Propuestas" value={formatMoney(montoPropuestas)} icon={IconMoney} subtext="Valor del pipeline" />
                    <KpiCard title="Tasa Conversi√≥n (Monto)" value={formatPercent(tasaConversionMonto)} icon={IconPercent} subtext="Eficiencia econ√≥mica" />
                </div>

                {/* VENDEDOR GR√ÅFICAS */}
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    {/* Cantidad Vendedor */}
                    <div className="card-pro p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-sm font-bold text-slate-700 flex items-center uppercase tracking-wider"><span className="w-1 h-4 bg-rose-600 rounded mr-2"></span>Ventas (Cant)</h2>
                        </div>
                        <div className="h-[20rem] w-full clickable-chart">
                            <ResponsiveContainer width="100%" height="100%">
                                <BarChart data={datosVendedoresCantidad} onClick={(d) => d && d.activePayload && toggleFiltro(setFiltrosVendedor, d.activePayload[0].payload.name)} margin={{top: 20, right: 10, left: 0, bottom: 60}}>
                                    <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" />
                                    <XAxis dataKey="name" angle={-45} textAnchor="end" interval={0} tick={{fontSize: 10, fill: '#64748b', fontWeight: 500}} tickLine={false} axisLine={false} dy={10} />
                                    <YAxis fontSize={11} tickLine={false} axisLine={false} stroke="#94a3b8" />
                                    <Tooltip cursor={{fill: '#fff1f2'}} contentStyle={{borderRadius:'8px', border:'none', boxShadow:'0 4px 6px -1px rgba(0,0,0,0.1)'}} />
                                    <Bar dataKey="valor" radius={[4, 4, 0, 0]}>
                                        {datosVendedoresCantidad.map((entry, index) => (
                                            <Cell key={`cell-${index}`} fill={getBarColor(entry.name, filtrosVendedor, COLORS.primary, COLORS.inactive)} className="transition-all duration-300" />
                                        ))}
                                        <LabelList dataKey="valor" position="top" style={{fontSize: '11px', fontWeight: 'bold', fill: '#475569'}} />
                                    </Bar>
                                </BarChart>
                            </ResponsiveContainer>
                        </div>
                    </div>

                    {/* Monto Vendedor */}
                    <div className="card-pro p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-sm font-bold text-slate-700 flex items-center uppercase tracking-wider"><span className="w-1 h-4 bg-rose-800 rounded mr-2"></span>Ventas (Dinero)</h2>
                        </div>
                        <div className="h-[20rem] w-full clickable-chart">
                            <ResponsiveContainer width="100%" height="100%">
                                <BarChart data={datosVendedoresMonto} onClick={(d) => d && d.activePayload && toggleFiltro(setFiltrosVendedor, d.activePayload[0].payload.name)} margin={{top: 20, right: 10, left: 0, bottom: 60}}>
                                    <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" />
                                    <XAxis dataKey="name" angle={-45} textAnchor="end" interval={0} tick={{fontSize: 10, fill: '#64748b', fontWeight: 500}} tickLine={false} axisLine={false} dy={10} />
                                    <YAxis fontSize={11} tickLine={false} axisLine={false} tickFormatter={formatMoneyShort} stroke="#94a3b8" />
                                    <Tooltip cursor={{fill: '#fff1f2'}} contentStyle={{borderRadius:'8px', border:'none', boxShadow:'0 4px 6px -1px rgba(0,0,0,0.1)'}} formatter={(value) => formatMoney(value)} />
                                    <Bar dataKey="valor" radius={[4, 4, 0, 0]}>
                                        {datosVendedoresMonto.map((entry, index) => (
                                            <Cell key={`cell-${index}`} fill={getBarColor(entry.name, filtrosVendedor, COLORS.accent, COLORS.inactive)} className="transition-all duration-300" />
                                        ))}
                                        <LabelList dataKey="valor" position="top" formatter={formatMoneyShort} style={{fontSize: '11px', fontWeight: 'bold', fill: '#475569'}} />
                                    </Bar>
                                </BarChart>
                            </ResponsiveContainer>
                        </div>
                    </div>
                </div>

                {/* MESES GR√ÅFICAS */}
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    {/* Cantidad Mes */}
                    <div className="card-pro p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-sm font-bold text-slate-700 flex items-center uppercase tracking-wider"><span className="w-1 h-4 bg-rose-600 rounded mr-2"></span>Tendencia (Cant)</h2>
                        </div>
                        <div className="h-[20rem] w-full clickable-chart">
                            <ResponsiveContainer width="100%" height="100%">
                                <BarChart data={datosMesesCantidad} onClick={(d) => d && d.activePayload && toggleFiltro(setFiltrosMes, d.activePayload[0].payload.name)} margin={{top: 20, right: 10, left: 0, bottom: 30}}>
                                    <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" />
                                    <XAxis dataKey="name" interval={0} tick={{fontSize: 10, fill: '#64748b', fontWeight: 500}} tickLine={false} axisLine={false} />
                                    <YAxis fontSize={11} tickLine={false} axisLine={false} stroke="#94a3b8" />
                                    <Tooltip cursor={{fill: '#fff1f2'}} contentStyle={{borderRadius:'8px', border:'none', boxShadow:'0 4px 6px -1px rgba(0,0,0,0.1)'}} />
                                    <Bar dataKey="valor" radius={[4, 4, 0, 0]}>
                                        {datosMesesCantidad.map((entry, index) => (
                                            <Cell key={`cell-${index}`} fill={getBarColor(entry.name, filtrosMes, COLORS.primary, COLORS.inactive)} className="transition-all duration-300" />
                                        ))}
                                        <LabelList dataKey="valor" position="top" style={{fontSize: '11px', fontWeight: 'bold', fill: '#475569'}} />
                                    </Bar>
                                </BarChart>
                            </ResponsiveContainer>
                        </div>
                    </div>
                    {/* Monto Mes */}
                    <div className="card-pro p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-sm font-bold text-slate-700 flex items-center uppercase tracking-wider"><span className="w-1 h-4 bg-rose-800 rounded mr-2"></span>Tendencia (Dinero)</h2>
                        </div>
                        <div className="h-[20rem] w-full clickable-chart">
                            <ResponsiveContainer width="100%" height="100%">
                                <BarChart data={datosMesesMonto} onClick={(d) => d && d.activePayload && toggleFiltro(setFiltrosMes, d.activePayload[0].payload.name)} margin={{top: 20, right: 10, left: 0, bottom: 30}}>
                                    <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" />
                                    <XAxis dataKey="name" interval={0} tick={{fontSize: 10, fill: '#64748b', fontWeight: 500}} tickLine={false} axisLine={false} />
                                    <YAxis fontSize={11} tickLine={false} axisLine={false} tickFormatter={formatMoneyShort} stroke="#94a3b8" />
                                    <Tooltip cursor={{fill: '#fff1f2'}} contentStyle={{borderRadius:'8px', border:'none', boxShadow:'0 4px 6px -1px rgba(0,0,0,0.1)'}} formatter={(value) => formatMoney(value)} />
                                    <Bar dataKey="valor" radius={[4, 4, 0, 0]}>
                                        {datosMesesMonto.map((entry, index) => (
                                            <Cell key={`cell-${index}`} fill={getBarColor(entry.name, filtrosMes, COLORS.accent, COLORS.inactive)} className="transition-all duration-300" />
                                        ))}
                                        <LabelList dataKey="valor" position="top" formatter={formatMoneyShort} style={{fontSize: '11px', fontWeight: 'bold', fill: '#475569'}} />
                                    </Bar>
                                </BarChart>
                            </ResponsiveContainer>
                        </div>
                    </div>
                </div>

                {/* METAS Y ACELER√ìMETROS */}
                <div className="mb-12">
                     <h2 className="text-xl font-bold text-slate-800 mb-6 flex items-center justify-between px-2 border-l-4 border-rose-500 pl-4">
                        <span className="flex items-center">Cumplimiento de Metas</span>
                        <span className="text-xs bg-white border border-slate-200 text-slate-500 px-3 py-1 rounded-md font-medium">
                            {filtrosMes.length > 0 ? `Meta Acumulada (${filtrosMes.length} meses)` : 'Meta Anual'}
                        </span>
                    </h2>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        {acelerometrosVisibles.map((vendedor, index) => (
                            <GaugeChart 
                                key={index}
                                nombre={vendedor.nombre}
                                vendido={vendedor.vendido}
                                meta={vendedor.meta}
                                filtrosMes={filtrosMes}
                            />
                        ))}
                    </div>
                </div>

                {/* UDN GRAPH */}
                <div className="mb-12 card-pro p-6">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-sm font-bold text-slate-700 flex items-center uppercase tracking-wider"><span className="w-1 h-4 bg-rose-400 rounded mr-2"></span>Ventas por UDN</h2>
                        <span className="text-xs text-slate-400 font-medium">Clic para filtrar</span>
                    </div>
                    <div className="h-[24rem] w-full clickable-chart">
                        <ResponsiveContainer width="100%" height="100%">
                            <BarChart data={datosUDNMonto} onClick={(d) => d && d.activePayload && toggleFiltro(setFiltrosUDN, d.activePayload[0].payload.name)} margin={{top: 20, right: 10, left: 0, bottom: 30}}>
                                <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" />
                                <XAxis dataKey="name" interval={0} tick={{fontSize: 11, fill: '#64748b', fontWeight: 500}} tickLine={false} axisLine={false} />
                                <YAxis fontSize={11} tickLine={false} axisLine={false} tickFormatter={formatMoneyShort} stroke="#94a3b8" />
                                <Tooltip cursor={{fill: '#fff1f2'}} contentStyle={{borderRadius:'8px', border:'none', boxShadow:'0 4px 6px -1px rgba(0,0,0,0.1)'}} formatter={(value) => formatMoney(value)} />
                                <Bar dataKey="valor" radius={[4, 4, 0, 0]}>
                                    {datosUDNMonto.map((entry, index) => (
                                        <Cell key={`cell-${index}`} fill={getBarColor(entry.name, filtrosUDN, COLORS.primary, COLORS.inactive)} className="transition-all duration-300" />
                                    ))}
                                    <LabelList dataKey="valor" position="top" formatter={formatMoneyShort} style={{fontSize: '11px', fontWeight: 'bold', fill: '#475569'}} />
                                </Bar>
                            </BarChart>
                        </ResponsiveContainer>
                    </div>
                </div>

                {/* TOP 10 CONTENIDO */}
                <div className="mb-12 card-pro p-6">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-sm font-bold text-slate-700 flex items-center uppercase tracking-wider"><span className="w-1 h-4 bg-rose-800 rounded mr-2"></span>Top 10 Contenidos</h2>
                        <span className="text-xs text-slate-400 font-medium">M√°s Rentables</span>
                    </div>
                    <div className="h-[24rem] w-full">
                        <ResponsiveContainer width="100%" height="100%">
                            <BarChart data={datosTopContenido} margin={{top: 20, right: 10, left: 0, bottom: 60}}>
                                <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" />
                                <XAxis dataKey="name" angle={-45} textAnchor="end" interval={0} tick={{fontSize: 10, fill: '#64748b', fontWeight: 500}} tickLine={false} axisLine={false} dy={10} />
                                <YAxis fontSize={11} tickLine={false} axisLine={false} tickFormatter={formatMoneyShort} stroke="#94a3b8" />
                                <Tooltip cursor={{fill: '#fff1f2'}} contentStyle={{borderRadius:'8px', border:'none', boxShadow:'0 4px 6px -1px rgba(0,0,0,0.1)'}} formatter={(value) => formatMoney(value)} />
                                <Bar dataKey="valor" radius={[4, 4, 0, 0]} fill={COLORS.accent}>
                                    <LabelList dataKey="valor" position="top" formatter={formatMoneyShort} style={{fontSize: '11px', fontWeight: 'bold', fill: '#475569'}} />
                                </Bar>
                            </BarChart>
                        </ResponsiveContainer>
                    </div>
                </div>

                {/* TABLA DE DETALLE */}
                <div className="w-full card-pro p-0 overflow-hidden mb-12">
                    <div className="p-6 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center">
                        <h2 className="text-sm font-bold text-slate-700 flex items-center uppercase tracking-wider"><span className="w-1 h-4 bg-rose-600 rounded mr-2"></span>Detalle Operativo</h2>
                        <div className="flex items-center gap-4">
                            <div className="relative">
                                <input type="text" placeholder="Buscar cliente..." className="pl-8 pr-4 py-1.5 text-xs border border-slate-300 rounded-md focus:outline-none focus:border-rose-500 focus:ring-1 focus:ring-rose-500 transition-colors w-48 text-slate-600"
                                    value={busquedaCliente} onChange={(e) => { setBusquedaCliente(e.target.value); setPaginaActual(1); }} />
                                <div className="absolute left-2.5 top-1.5 text-slate-400">{IconSearch}</div>
                            </div>
                            <span className="text-xs font-bold text-slate-500 bg-white border border-slate-200 px-3 py-1.5 rounded-md">{dataTablaFiltrada.length} Reg</span>
                        </div>
                    </div>
                    
                    <div className="overflow-auto">
                        <table className="w-full text-left text-xs">
                            <thead className="bg-slate-50 sticky top-0 z-10">
                                <tr>
                                    {COLUMNAS_TABLA.map(k => (
                                        <th key={k} className={`px-6 py-4 font-bold text-slate-500 uppercase tracking-wider border-b border-slate-200 ${k === 'NOMBRE DE LA CAMPANA' ? 'w-48' : 'whitespace-nowrap'}`}>
                                            {k}
                                        </th>
                                    ))}
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-slate-100">
                                {dataTablaPaginada.map((row, i) => (
                                    <tr key={i} className="hover:bg-slate-50/80 transition-colors">
                                        {COLUMNAS_TABLA.map(k => (
                                            <td key={k} className={`px-6 py-4 text-slate-700 font-medium ${k === 'NOMBRE DE LA CAMPANA' ? 'max-w-[200px] truncate' : 'whitespace-nowrap'}`}>
                                                {row[k] || '-'}
                                            </td>
                                        ))}
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    {/* PAGINACI√ìN */}
                    {totalPaginas > 1 && (
                        <div className="p-4 border-t border-slate-100 flex justify-between items-center bg-slate-50/30">
                            <button onClick={() => cambiarPagina('prev')} disabled={paginaActual === 1}
                                className={`px-3 py-1 rounded-md text-xs font-bold ${paginaActual === 1 ? 'text-slate-300 cursor-not-allowed' : 'text-slate-600 hover:bg-slate-100'}`}>
                                ‚Üê Anterior
                            </button>
                            <span className="text-xs font-medium text-slate-500">P√°gina {paginaActual} de {totalPaginas}</span>
                            <button onClick={() => cambiarPagina('next')} disabled={paginaActual === totalPaginas}
                                className={`px-3 py-1 rounded-md text-xs font-bold ${paginaActual === totalPaginas ? 'text-slate-300 cursor-not-allowed' : 'text-slate-600 hover:bg-slate-100'}`}>
                                Siguiente ‚Üí
                            </button>
                        </div>
                    )}
                </div>

                <div className="text-center mt-12 mb-6 text-slate-400 text-xs font-medium">
                    Dashboard Ejecutivo &bull; Actualizaci√≥n en Tiempo Real
                </div>
            </div>
        );
    };

    // ==========================================
    // APP PRINCIPAL (CONTENEDOR DE PESTA√ëAS)
    // ==========================================
    const App = () => {
        const [activeTab, setActiveTab] = useState('sales');

        return (
            <div className="min-h-screen bg-slate-50 pb-20">
                
                {/* Navegaci√≥n Superior Responsive */}
                <div className="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="flex flex-col sm:flex-row justify-between h-auto sm:h-16 py-2 sm:py-0">
                            <div className="flex flex-col sm:flex-row w-full sm:w-auto">
                                {/* Logo & Date Row for Mobile */}
                                <div className="flex justify-between items-center w-full sm:w-auto">
                                    <div className="flex-shrink-0 flex items-center">
                                        <div className="w-8 h-8 bg-slate-900 rounded-lg flex items-center justify-center text-white font-bold text-xl mr-2">I</div>
                                        <span className="font-bold text-slate-800 text-lg tracking-tight">Ivan<span className="text-slate-400">Producciones</span></span>
                                    </div>
                                    <div className="sm:hidden flex items-center">
                                         <span className="text-[10px] text-slate-400 font-medium bg-slate-100 px-2 py-1 rounded-full">{new Date().toLocaleDateString()}</span>
                                    </div>
                                </div>

                                {/* Tabs */}
                                <div className="flex mt-2 sm:mt-0 sm:ml-8 w-full sm:w-auto border-t sm:border-t-0 border-slate-100 pt-1 sm:pt-0 overflow-x-auto">
                                    <button
                                        onClick={() => setActiveTab('sales')}
                                        className={`flex-1 sm:flex-none text-center py-2 sm:py-0 inline-flex items-center justify-center px-2 pt-1 border-b-2 text-sm font-medium transition-colors duration-200 whitespace-nowrap ${
                                            activeTab === 'sales'
                                            ? 'border-rose-500 text-slate-900 bg-rose-50 sm:bg-transparent'
                                            : 'border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300'
                                        }`}
                                    >
                                        Dashboard Ventas
                                    </button>
                                    <button
                                        onClick={() => setActiveTab('strategy')}
                                        className={`flex-1 sm:flex-none text-center py-2 sm:py-0 inline-flex items-center justify-center px-2 pt-1 border-b-2 text-sm font-medium transition-colors duration-200 ml-2 whitespace-nowrap ${
                                            activeTab === 'strategy'
                                            ? 'border-emerald-500 text-slate-900 bg-emerald-50 sm:bg-transparent'
                                            : 'border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300'
                                        }`}
                                    >
                                        An√°lisis de Recompra
                                    </button>
                                    <button
                                        onClick={() => setActiveTab('cxc')}
                                        className={`flex-1 sm:flex-none text-center py-2 sm:py-0 inline-flex items-center justify-center px-2 pt-1 border-b-2 text-sm font-medium transition-colors duration-200 ml-2 whitespace-nowrap ${
                                            activeTab === 'cxc'
                                            ? 'border-violet-500 text-slate-900 bg-violet-50 sm:bg-transparent'
                                            : 'border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300'
                                        }`}
                                    >
                                        Cuentas por Cobrar
                                    </button>
                                </div>
                            </div>
                            
                            {/* Desktop Date */}
                            <div className="hidden sm:flex items-center">
                                <span className="text-xs text-slate-400 font-medium bg-slate-100 px-3 py-1 rounded-full">{new Date().toLocaleDateString()}</span>
                            </div>
                        </div>
                    </div>
                </div>

                {/* Contenido Din√°mico */}
                <main className="w-full">
                    {activeTab === 'sales' && <TabSales />}
                    {activeTab === 'strategy' && <TabStrategy />}
                    {activeTab === 'cxc' && <TabCXC />}
                </main>

            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>

</body>
</html>
